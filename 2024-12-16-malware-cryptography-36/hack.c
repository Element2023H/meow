/*
 * hack.c - random sbox generation algorithms.
 * Fisher-Yates shuffle
 * Simple C implementation
 * @cocomelonc
 * https://cocomelonc.github.io/malware/2024/12/16/malware-cryptography-36.html
 */
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

#define SBOX_SIZE 256

// Fisher-Yates shuffle
void fisher_yates_shuffle(unsigned char *sbox, int size) {
  for (int i = size - 1; i > 0; i--) {
    // generate a random index between 0 and i
    int j = rand() % (i + 1);

    // swap sbox[i] and sbox[j]
    unsigned char temp = sbox[i];
    sbox[i] = sbox[j];
    sbox[j] = temp;
  }
}

int main() {
  unsigned char sbox[SBOX_SIZE];

  // initialize sbox with values 0 to 255
  for (int i = 0; i < SBOX_SIZE; i++) {
    sbox[i] = (unsigned char)i;
  }

  // seed the random number generator with the current time
  srand((unsigned int)time(NULL));

  // shuffle the sbox using Fisher-Yates algorithm
  fisher_yates_shuffle(sbox, SBOX_SIZE);

  // print the shuffled sbox
  printf("generated S-box:\n");
  for (int i = 0; i < SBOX_SIZE; i++) {
    printf("%02x", sbox[i]);
    if ((i + 1) % 16 == 0) {
      printf("\n"); // print a newline every 16 values
    } else {
      printf(" ");
    }
  }

  return 0;
}
